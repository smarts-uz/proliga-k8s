apiVersion: v1
kind: Namespace
metadata:
  name: opensearch

---

apiVersion: opensearch.opster.io/v1
kind: OpenSearchCluster
metadata:
  name: my-first-cluster
  namespace: opensearch
spec:
  general:
    serviceName: my-first-cluster
    version: "3.1.0"
    pluginsList:
      - analysis-icu
  nodePools:
    - component: nodes
      replicas: 3                 # 3-node HA cluster
      diskSize: "10Gi"
      resources:
        requests:
          memory: "2Gi"
          cpu: "500m"
        limits:
          memory: "2Gi"
          cpu: "500m"
      roles:
        - cluster_manager         # Required for election/quorum
        - data
  initHelper:
    image: docker.io/busybox:1.36
    imagePullPolicy: IfNotPresent
    resources: {}
    version: "1.36"
  security:
    config:
      adminCredentialsSecret:
        name: ""                  # auto-generated by operator
      adminSecret:
        name: ""                  # auto-generated
      securityConfigSecret:
        name: ""                  # auto-generated
      updateJob:
        resources: {}
    tls:
      http:
        generate: true
        secret:
          name: my-first-cluster-http-tls
      transport:
        generate: true
        perNode: true
        secret:
          name: my-first-cluster-transport-tls

---

apiVersion: v1
kind: Service
metadata:
  name: opensearch-nodeport
  namespace: opensearch
spec:
  type: NodePort
  selector:
    opster.io/opensearch-cluster: my-first-cluster
  ports:
    - name: rest
      port: 9200          # Cluster port
      targetPort: 9200    # Pod port
      nodePort: 30920     # External access port
      protocol: TCP
